# 缩放比例

随着世界比以往任何时候都更加关注 web，我们所有的 web 应用程序都需要服务更多的请求。为了应对更多的请求，我们可能需要扩展应用程序以支持它们。

本章主要介绍可应用于常规应用程序以解决可伸缩性问题的技术、库和工具。

在本章中，我们将讨论以下主题：

*   集群及其好处
*   负载平衡
*   扩展数据库
*   分布式缓存

# 群集

简单地说，集群就是添加多个服务器来提供相同的服务。它将帮助我们避免在系统崩溃和其他不幸情况等灾难期间中断。群集可以用作故障切换系统、负载平衡系统或并行处理单元。

故障转移群集是一组服务器，所有服务器中都复制了示例应用程序，以便向客户端提供相同的服务，以保持应用程序和服务的高可用性。如果一台服务器由于某种原因出现故障，其余服务器将接管负载并向用户提供不间断的服务。

*   **向上扩展（垂直扩展）**：这是关于向我们的服务器添加更多资源，例如，增加 RAM、硬盘容量和处理器。尽管这可能是一个不错的选择，但它只适用于某些场景，而不是所有场景。在某些情况下，添加更多资源可能会很昂贵。
*   **向外扩展（水平扩展）**：与在一台服务器中添加更多资源不同，向外扩展的重点是向服务请求添加更多服务器/节点。这种分组称为集群，因为所有服务器都在执行相同类型的任务，但在不同的服务器上复制以避免中断。

# 集群的好处

集群是扩展服务的首选解决方案，因为它提供了一个快速灵活的选项，可以在需要时添加更多服务器，而不会中断现有服务。可在缩放期间提供不间断服务。在扩展应用程序时，用户无需等待任何接近停机时间的事情。所有服务器负载都由中央负载平衡服务器进行适当平衡。

# 负载平衡

负载平衡器是集群中最有用的工具。负载平衡器使用各种算法（如循环、最少连接等）将传入的请求转发到正确的后端服务器进行处理。

市场上有很多第三方负载平衡器，比如 F5（[https://f5.com](https://f5.com) 、HAProxy（[http://www.haproxy.org](http://www.haproxy.org) ），等等。尽管这些负载平衡工具的行为有所不同，但它们关注的主要角色是：将请求负载分配到可用的后端服务器，并保持所有服务器之间的平衡。通过适当的负载平衡，我们可以防止单个后端服务器过载。此外，大多数负载平衡器都带有运行状况监视，例如检查以验证服务服务器的可用性。

除了服务器之间的主要请求分发之外，负载平衡器还保护后端服务器不受前端服务器的影响。前端服务器将不知道向哪个后端服务器发送请求，因为负载平衡器会隐藏有关后端服务器的所有详细信息。

# 扩展数据库

扩展数据库是建筑设计中具有挑战性的部分之一。这里，我们将讨论一些用于扩展应用程序的数据库扩展技术。

# 垂直缩放

如前所述，在应用程序服务器级别，我们还可以利用数据库服务器的扩展技术。添加更多的功能，如 CPU 和 RAM，将在查询数据库时带来更好的性能。通过使用垂直缩放技术，我们可以获得一致的性能，并且在出现问题时也很容易调试。此外，与水平缩放相比，垂直缩放提供了更高的效率。但是，垂直扩展可能需要定期停机才能安装新硬件，并且受到硬件容量的限制。

# 水平缩放

正如我们在应用程序级别讨论的水平扩展一样，我们可以通过向集群添加更多的机器来处理数据库负载，从而对数据库服务器执行同样的操作。与垂直缩放相比，它要便宜得多；然而，这也带来了集群配置、维护和管理成本的成本结构。

# 读取副本

通过保留多个可用于读取目的的从机，我们可以显著改进应用程序。读取副本有助于读取所有只读从机中的数据。但是，当我们需要发送写请求时，我们可以使用主数据库。主数据库可以用于写入和读取目的，从数据库只能用于读取目的。我们安装的从属设备越多，可以处理的基于读取的查询就越多。这种读取副本技术在需要处理的最小写入查询和最大读取查询的场景中非常有用。

# 池连接

当应用程序查询数据库时，它会创建一个客户端连接，发送查询并获取结果。由于到数据库的客户端连接是一项昂贵的操作，因此必须重新使用这些连接以进行进一步的查询。在这种情况下，连接池将有助于防止需要为每个请求建立到数据库的连接。通过保持更好的连接池（如 HikariCP），我们可以提高应用程序的性能。

# 使用多个主控形状

与读取副本一样，多个主机制提供了复制多个数据库服务器的选项。与读取副本复制从属数据库不同，这里我们复制主数据库以写入和读取数据。此模式对于特定场景非常有用，例如 RESTAPI 数据事务应用程序。在多主机模式中，我们要求我们的应用程序生成**通用唯一标识符**（**UUID**s），以防止多主机复制过程中的数据冲突。

# 数据库服务器中的负载平衡

由于来自应用服务器的客户端连接限制是基于数据库供应商的，因此当应用服务器请求更多连接时，处理这种情况可能很棘手。通过保持负载平衡器，我们可以使用连接池将数据库查询分发到可用的数据库服务器。在负载平衡器的帮助下，我们将确保所有数据库服务器的负载相等；但是，这取决于特定负载平衡器中使用的算法。

# 数据库分区

当我们处理需要高端服务器且需要大量时间查询的大型数据库时，对数据库进行分区非常有用。此外，当应用程序需要查询大量读写请求时，这也很有用。分区可以水平和垂直进行。水平和垂直分区在以下部分中进行了描述。

# 分片（水平分区）

一个数据库表可以根据任何特定属性拆分为多个表。例如，一个用户数据库可以分为两个不同的数据库，如`user_1`和`user_2`，其中`user_1`表的用户名以*a*-*N*开头，`user_2`表的用户名以*O*-*Z*开头。通过像前面那样拆分数据库，我们可以减少每个表上的行数，从而提高性能。

# 垂直分割

在垂直分区中，可以根据业务概念将数据库表拆分为多个表。例如，一个表可能有更多的列，以便于访问其他表以获得更好的性能。

通过同时进行水平和垂直分区，查询数据库将花费更少的时间并提高性能。此外，通过将大型数据库划分为小块，我们可以避免使用高端计算机。这些数据碎片也可以分发到低商品服务器中以节省资金。但是，在特定场景中，数据共享可能是一个复杂的过程。

# 分布式缓存

分布式缓存技术将有助于提高 web 服务的可伸缩性。与进程内缓存不同，分布式缓存不需要构建在相同的应用程序空间中。它们可以存储在集群的多个节点上。尽管分布式缓存部署在多个节点上，但它们提供了缓存的单一状态。

# 数据层缓存

在数据库中添加缓存层将提供更好的性能。它被认为是提高性能的常用策略，尤其是在我们的应用程序中读取请求很重的情况下。这里，我们将讨论 Hibernate 的缓存级别。

# 一级缓存

一级缓存是由 Hibernate 启用的内置会话缓存，它是贯穿所有请求的强制缓存。在 Hibernate 中没有禁用第一级缓存的选项。第一级缓存与会话对象关联，并且在会话过期后将丢失。当我们第一次查询 web 服务时，将从数据库中检索对象并将其存储在与 Hibernate 会话关联的一级缓存中。如果我们再次请求相同的实体，它将从缓存中检索，而无需查询数据库。

# 二级缓存

第二级缓存是 Hibernate 中的可选缓存。在我们的请求到达第二级缓存之前，第一级缓存将是联系点。第二级缓存可以按类或集合配置，它负责跨会话缓存对象。

由于只有少数类从缓存中受益，因此默认情况下禁用二级缓存。可以为服务设计人员启用它。

# 应用层缓存

就像在数据库中缓存一样，我们也可以缓存应用程序层中的任何对象，以提高应用程序的性能。这里，我们将讨论各种对象缓存，特别是键值缓存工具，并检查它们在市场上的唯一性。

# Memcached

由于大多数公司在他们的应用程序中使用 MycCurp（AutoT0T），所以我们认为 MimcCurp 是最强大的分布式缓存系统之一。它遵循分布式内存缓存机制，在重复的场景中非常有用，例如，当同一服务被多次请求时。

# 雷迪斯

Redis（[https://redis.io](https://redis.io) 是另一个可用于缓存的内存中键值存储。Redis 支持诸如散列、列表、集合等数据结构。Redis 被认为是最流行的键值存储之一，支持高级键值缓存。Redis 支持交叉和并集等操作。由于其先进的功能和速度，它比 Memcached 更受欢迎。

# 黑兹卡斯特

Hazelcast（[https://hazelcast.com](https://hazelcast.com) 是一个内存中的数据网格，支持分布式收集并简化分布式计算。它提供了一个简单的 API 和一个简单直接的部署策略。由于 Hazelcast 提供了 Memcached 客户端库，因此使用 Memcached 集群的应用程序可能能够适应 Hazelcast 集群。Hazelcast 体系结构支持集群平台中的数据分发和高可扩展性。它还提供智能同步和自动发现。Hazelcast 提供分布式数据结构、分布式查询和分布式计算等功能。Spring Boot 在其框架中为 Hazelcast 提供了显式缓存支持。

# Ehcache

Ehcache（[http://www.ehcache.org](http://www.ehcache.org) 由于其简化的可扩展选项，主要用于中小型部署。它被认为是应用最广泛的分布式缓存之一。此外，Ehcache 还提供了与其他流行库和框架集成的选项。Ehcache 扩展从进程内缓存开始，经过进程内和进程外混合部署。此外，Ehcache 还提供了 Terracotta 服务器来提高缓存性能。

# 里亚克

里亚克（[https://github.com/basho/riak](https://github.com/basho/riak) 是一种基于 Erlang 的键值数据存储，具有容错性和高可用性。在 Riak 中，数据可以存储在内存、磁盘或两者中。Riak 可以通过 HTTP API 或本机 Erlang 接口等协议进行访问。Riak 支持 Java、C 和 Python 等主要语言。此外，它还支持 MapReduce，在大数据相关操作中可以灵活使用。

# 空气钉

Aerospike（[https://www.aerospike.com](https://www.aerospike.com) 是一个开源、闪存优化、内存中 NoSQL 数据库和键值存储。Aerospike 在三层上运行：闪存优化数据层、自我管理分发层和集群感知客户端层。为确保一致性，分发层在所有数据中心中都进行了复制。即使单个服务器节点出现故障或从集群中删除，这些副本仍将保持功能。

# 英菲尼斯潘

英菲尼斯潘（[http://infinispan.org/](http://infinispan.org/) 是一个分布式内存键值数据存储，可用作缓存或数据网格。它可以作为库或通过 REST 等协议访问。此外，Infinispan 还可以与 JPA、JCache、Spring 和 Spark 集成。Infinispan 支持大多数与 MapReduce 相关的操作。

# Cache2k

Cache2k（[https://cache2k.org/](https://cache2k.org/) 在 Java 应用程序中提供内存中对象缓存选项。Cache2k 主要关注 JVM 内部的缓存。

# 其他分布式缓存

之前，我们讨论了主要缓存工具及其机制。在这里，我们将进一步讨论市场上提供的其他分布式缓存：

# 亚马逊弹力织物

ElastiCache 主要用作内存中的数据存储和缓存服务；它是由 AWS 引入的。有了 Amazon ElastiCache 的支持，我们可以快速部署缓存环境，而无需任何复杂的安装。它支持 Memcached 和 Redis 缓存。

# Oracle 分布式缓存（一致性）

在这个分布式缓存中，数据在集群中的所有计算机中进行分区。这些分区缓存将被配置为保留集群中节点上的每个数据段。分布式缓存是一致性中最常用的缓存。

尽管市场上有很多缓存解决方案，但选择特定的解决方案取决于许多因素，例如业务需求、性能需求、数据完整性、容错性、成本等等。将正确的分布式缓存层添加到应用层和数据库层将获得更好的性能。

# 总结

在本章中，我们讨论了扩展 RESTful web 服务的不同库、工具和技术。在开发应用程序时，我们必须通过使用定义良好的接口来寻找系统组件之间的松散耦合。在下一章中，我们将讨论微服务及其好处。